<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="room">

	<!-- 시퀀스 생성 -->
	<select id="sequence" resultType="int">
		select room_seq.nextval from dual
	</select>
	
	<!-- 방 생성 -->
	<insert id="insert">
		insert into room(room_no, room_name, room_created)
		values(#{roomNo}, #{roomName}, #{roomCreated})
	</insert>
	
	<select id="list" resultType="RoomDto">
		select * from room order by room_no asc
	</select>
	
	<select id="detail" resultType="RoomDto">
		select * from room where room_no = #{roomNo}
	</select>
	
	<select id="listByUser" resultType="RoomVO">
		select
			R.*, nvl(RM.users_id, 'Y', 'N') "join"
		from
			room R left outer join (
				select * from room_member where users_id = #{usersId}
			) RM
				on R.room_no = RM.room_no
		order by R.room_no asc
	</select>
	
</mapper>